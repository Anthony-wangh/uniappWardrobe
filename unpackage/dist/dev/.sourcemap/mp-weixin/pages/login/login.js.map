{"version":3,"file":"login.js","sources":["pages/login/login.vue","D:/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\n\t<view class=\"login-container\">\r\n\t\t<image class=\"bg-image\" src=\"/static/main/bg.png\" mode=\"aspectFill\"></image>\r\n\t\t\r\n\t\t<view class=\"main-body\">\r\n\t\t\t<image class=\"center-icon\" src=\"/static/main/icon_Center.png\" mode=\"aspectFit\"></image>\r\n\t\t\t<text class=\"name\">我的衣橱管家</text>\r\n\t\t\t<text class=\"slogen\">开启你的精致生活</text>\r\n\t\t\t\r\n\t\t\t<text class=\"login-btn\" @click=\"loginClick\">\r\n\t\t\t\t{{isLoggedin?'开启精致生活':'一键登录'}}\t\r\n\t\t\t</text>\t\t\r\n\t\t\t<image class=\"bottom-icon\" src=\"/static/main/icon.png\" mode=\"aspectFit\"></image>\r\n\t\t</view>\t\t\t\r\n\t\t\r\n\t</view>\n</template>\n\n<script>\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tisLoggedin:false,\n\t\t\t}\n\t\t},\r\n\t\tonShow() {\r\n\t\t\tconst token = uni.getStorageSync('wardrobeToken') || '';\r\n\t\t\tthis.isLoggedin = token !=='';\r\n\t\t},\n\t\tmethods: {\n\t\t\tloginClick(){\r\n\t\t\t\tif(this.isLoggedin){\r\n\t\t\t\t\tuni.switchTab({\r\n\t\t\t\t\t\turl:'/pages/main/main'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tthis.handleLogin();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\thandleLogin() {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '登录中...',\r\n\t\t\t\t\tmask: true // 防止触摸穿透\r\n\t\t\t\t});\r\n\t\t\t\r\n\t\t\t\t// 1. 直接调用 uni.getUserProfile，确保由用户点击直接触发\r\n\t\t\t\tuni.getUserProfile({\r\n\t\t\t\t\tdesc: '获取您的昵称和头像用于展示', // 此描述必填\r\n\t\t\t\t\tsuccess: (userProfileRes) => {\r\n\t\t\t\r\n\t\t\t\t\t\t// 2. 在获取用户信息成功后，再调用 uni.login 获取 code\r\n\t\t\t\t\t\tuni.login({\r\n\t\t\t\t\t\t\tprovider: 'weixin',\r\n\t\t\t\t\t\t\tsuccess: (loginRes) => {\r\n\t\t\t\t\t\t\t\tif (!loginRes.code) {\r\n\t\t\t\t\t\t\t\t\t// 隐藏加载提示框\r\n\t\t\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\ttitle: '获取 code 失败',\r\n\t\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t// 3. 调用云函数，将 code 和用户信息一起传递过去\r\n\t\t\t\t\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\t\t\t\t\tname: 'login',\r\n\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\tcode: loginRes.code,\r\n\t\t\t\t\t\t\t\t\t\tuserInfo: userProfileRes.userInfo\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}).then((result) => {\r\n\t\t\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t\t\t\tif (result.result.code === 200) {\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t//登陆状态，用作保持登录\r\n\t\t\t\t\t\t\t\t\t\tuni.setStorageSync('wardrobeToken', result.result.data.token);\r\n\t\t\t\t\t\t\t\t\t\t//用作修改用户信息\r\n\t\t\t\t\t\t\t\t\t\tuni.setStorageSync('wardrobeOpenid', result.result.data.openid);\r\n\t\t\t\t\t\t\t\t\t\t//通用用户信息\r\n\t\t\t\t\t\t\t\t\t\tuni.setStorageSync('wardrobeUserInfo', result.result.data.newUserInfo);\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tconsole.log(result.result.data);\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tconst usingDates = this.userInfo ? (Math.floor((Date\r\n\t\t\t\t\t\t\t\t\t\t\t.now() - this.userInfo.createTime\r\n\t\t\t\t\t\t\t\t\t\t) / (1000 * 60 * 60 * 24))) : 0;\r\n\t\t\t\t\t\t\t\t\t\t//使用天数\r\n\t\t\t\t\t\t\t\t\t\tuni.setStorageSync('wardrobeUsingDates', usingDates);\r\n\t\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\t\ttitle: '登录成功',\r\n\t\t\t\t\t\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t\t\t\t\t\t\tuni.switchTab({\r\n\t\t\t\t\t\t\t\t\t\t\t\turl:'/pages/main/main'\r\n\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t},100);\r\n\t\t\t\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\t\ttitle: result.result.msg,\r\n\t\t\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}).catch((err) => {\r\n\t\t\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\ttitle: '调用云函数失败',\r\n\t\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\tconsole.error('云函数错误：', err);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle: '登录失败',\r\n\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tconsole.error('uni.login 错误：', err);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '获取用户信息失败',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tconsole.error('getUserProfile 错误：', err);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t\n\t\t}\n\t}\n</script>\n\n<style scoped>\n\r\n.login-container{\r\n\theight: 100vh;\r\n\twidth: 100vw;\r\n\tposition: relative;\r\n}\r\n.bg-image{\r\n\tposition: absolute;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n}\r\n.main-body{\r\n\tposition: absolute;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\t/* justify-content: space-between; */\r\n\tjustify-items: center;\r\n\talign-items: center;\r\n}\r\n\r\n.center-icon{\r\n\tmargin-top: 20%;\r\n}\r\n\r\n.name{\r\n\tcolor: #C09AFF;\r\n\tfont-size: 40px;\r\n\tfont-weight: bold;\r\n\tmargin-top: 30px;\r\n}\r\n\r\n.slogen{\r\n\tcolor: #353535;\r\n\tfont-size: 20px;\r\n\tmargin-top: 15px;\r\n}\r\n\r\n.login-btn{\r\n\twidth: 70%;\r\n\tcolor: #fff;\r\n\tbackground-color: #C09AFF;\r\n\tborder-radius: 20px;\r\n\tfont-size: 18px;\r\n\tfont-weight: bold;\r\n\tpadding: 10px 00px;\r\n\ttext-align: center;\r\n\tmargin-top: 200px;\r\n}\r\n.bottom-icon{\r\n\theight: 20px;\r\n\tmargin-bottom: 20px;\r\n\tposition: fixed;\r\n\tbottom: 20px;\r\n}\r\n\r\n\n</style>\n","import MiniProgramPage from 'E:/GitProject/uniappWardrobe/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":"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"}