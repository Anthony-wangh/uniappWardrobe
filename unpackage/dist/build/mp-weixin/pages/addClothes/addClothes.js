"use strict";const r=require("../../common/vendor.js"),e={components:{CategoryPicker:()=>"../../components/CategoryPickerModal.js",ImageCropper:()=>"../../components/nice-cropper/cropper.js"},data:()=>({statusBarHeight:0,form:{id:"",image:"",name:"",primaryCategory:"上衣",secondaryCategory:"T恤",value:"",notes:"",purchaseDate:"",brand:""},categories:{"上衣":["T恤","衬衫","外套","羽绒服"],"裤子":["牛仔裤","运动裤","休闲裤","裙子"],"鞋":["运动鞋","板鞋","高跟鞋","靴子"],"配饰":["帽子","眼镜","丝巾"],"包":["单肩包","双肩包"]},errorMsg:"",isEdit:!1,showSubFromgroup:!1,cropperSrc:"",tempCropperSrc:""}),onLoad(e){e.primaryCategory&&e.secondaryCategory&&(this.form.primaryCategory=decodeURIComponent(e.primaryCategory),this.form.secondaryCategory=decodeURIComponent(e.secondaryCategory)),this.statusBarHeight=r.index.getSystemInfoSync().statusBarHeight},methods:{openCategoryPicker(){var r;null==(r=this.$refs.categoryPicker)||r.open()},onCategoryConfirm(r){this.form.primaryCategory=r.main,this.form.secondaryCategory=r.sub},chooseImage(){r.index.chooseImage({count:1,sourceType:["album","camera"],success:r=>{this.cropperSrc=r.tempFilePaths[0]}})},quitCropper(){this.cropperSrc="",this.tempCropperSrc=""},comfireCropper(){this.cropperSrc="",this.form.image=this.tempCropperSrc,this.tempCropperSrc=""},beforeDraw(r,e){r.setFillStyle("white")},afterDraw(r,e){},cropped(r,e){this.tempCropperSrc=r},selectPurchaseDate(r){this.form.purchaseDate=r.detail.value},generateUniqueId:()=>"id_"+Date.now().toString(36)+Math.random().toString(36).substr(2,5),submitForm(){if(!this.form.image)return this.errorMsg="请上传衣服图片";if(!this.form.primaryCategory)return this.errorMsg="请选择一级类目";if(!this.form.secondaryCategory)return this.errorMsg="请选择二级类目";let e=r.index.getStorageSync("clothes")||[];if(this.isEdit){let r=e.findIndex((r=>r.id===this.form.id));-1!==r?e[r]=this.form:(this.form.id=this.generateUniqueId(),e.push(this.form))}else this.form.id=this.generateUniqueId(),e.push(this.form);r.index.setStorageSync("clothes",e),r.index.showToast({title:this.isEdit?"修改成功":"上传成功",icon:"success"}),this.resetForm(),setTimeout((()=>r.index.navigateBack()),100)},resetForm(){this.form={image:"",name:"",primaryCategory:"",secondaryCategory:"",value:"",notes:"",purchaseDate:"",brand:""},this.errorMsg=""}}};if(!Array){(r.resolveComponent("category-picker")+r.resolveComponent("image-cropper"))()}const o=r._export_sfc(e,[["render",function(e,o,t,a,s,i){return r.e({a:s.statusBarHeight+"px",b:s.form.image},s.form.image?{c:s.form.image}:{},{d:r.o(((...r)=>i.chooseImage&&i.chooseImage(...r))),e:r.t(s.form.primaryCategory&&s.form.secondaryCategory?s.form.primaryCategory+" / "+s.form.secondaryCategory:"请选择类目"),f:r.o(((...r)=>i.openCategoryPicker&&i.openCategoryPicker(...r))),g:s.form.name,h:r.o((r=>s.form.name=r.detail.value)),i:s.form.notes,j:r.o((r=>s.form.notes=r.detail.value)),k:r.t(s.showSubFromgroup?"收起":"更多"),l:r.o((r=>s.showSubFromgroup=!s.showSubFromgroup)),m:s.showSubFromgroup},s.showSubFromgroup?{n:r.t(s.form.purchaseDate||"请选择购买时间"),o:r.o(((...r)=>i.selectPurchaseDate&&i.selectPurchaseDate(...r))),p:s.form.value,q:r.o((r=>s.form.value=r.detail.value)),r:s.form.brand,s:r.o((r=>s.form.brand=r.detail.value))}:{},{t:r.o(((...r)=>i.submitForm&&i.submitForm(...r))),v:s.errorMsg},s.errorMsg?{w:r.t(s.errorMsg)}:{},{x:r.sr("categoryPicker","3995850b-0"),y:r.o(i.onCategoryConfirm),z:r.p({data:s.categories,defaultValue:[s.form.primaryCategory,s.form.secondaryCategory],cancelText:"关闭",confirmText:"选择"}),A:""!==s.cropperSrc},""!==s.cropperSrc?{B:r.o(i.cropped),C:r.o(i.afterDraw),D:r.o(i.beforeDraw),E:r.p({id:"image-cropper",zoom:1,angle:0,src:s.cropperSrc,canvasBackground:"red"}),F:r.o(((...r)=>i.quitCropper&&i.quitCropper(...r))),G:r.o(((...r)=>i.comfireCropper&&i.comfireCropper(...r)))}:{})}],["__scopeId","data-v-3995850b"]]);wx.createPage(o);
