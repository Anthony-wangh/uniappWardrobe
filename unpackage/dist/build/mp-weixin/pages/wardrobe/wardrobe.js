"use strict";const e=require("../../common/vendor.js"),t=require("../../common/assets.js"),o={data:()=>({currentMainCategoryIndex:0,currentSubCategoryIndex:0,categories:["上衣","裤子","鞋","配饰","包"],subCategories:{"上衣":["全部","T恤","衬衫","外套","羽绒服"],"裤子":["全部","牛仔裤","运动裤","休闲裤","裙子"],"鞋":["全部","运动鞋","高跟鞋","靴子","皮鞋","休闲鞋","拖鞋"],"配饰":["全部","帽子","眼镜","丝巾"],"包":["全部"]},clothes:[],showModal:!1,newCategoryName:"",errorMsg:"",filteredClothes:[],filteredClothesRows:[],showDeleteModal:!1,deleteCategoryIndex:null,editModel:!1,selectedClothes:[]}),computed:{currentSubCategories(){return this.subCategories[this.categories[this.currentMainCategoryIndex]]||[]}},onShow(){(getApp().globalData.wardrobeData||{}).editMode&&(this.editModel=!0,e.index.hideTabBar()),this.clothes=e.index.getStorageSync("clothes")||[];const t=e.index.getStorageSync("clothesCategories");t&&(this.categories=t),this.filteredClothesByCategory()},methods:{filteredClothesByCategory(){const e=this.categories[this.currentMainCategoryIndex],t=this.currentSubCategories[this.currentSubCategoryIndex];this.filteredClothes=this.clothes.filter((o=>{const s=o.primaryCategory===e,i="全部"===t||o.secondaryCategory===t;return s&&i})),this.filteredClothesWithRows()},filteredClothesWithRows(){const e=[];let t=[];this.filteredClothes.forEach(((o,s)=>{o&&(t.push(o),2!==t.length&&s!==this.filteredClothes.length-1||(e.push([...t]),t=[]))})),this.filteredClothesRows=e.filter((e=>e.length>0))},selectMainCategory(e){this.currentMainCategoryIndex=e,this.currentSubCategoryIndex=0,this.filteredClothesByCategory()},selectSubCategory(e){this.currentSubCategoryIndex=e,this.filteredClothesByCategory()},showAddCategoryModal(){this.showModal=!0,this.newCategoryName="",this.errorMsg=""},closeModal(){this.showModal=!1},addCategory(){const t=this.newCategoryName.trim();t?t.length>5?this.errorMsg="不得超过5个字符":this.categories.includes(t)?this.errorMsg="该类目已存在，请输入其他名称":(this.categories.push(t),this.subCategories[t]=["全部"],e.index.setStorageSync("clothesCategories",this.categories),this.closeModal(),e.index.showToast({title:"添加类目成功！",icon:"success"})):this.errorMsg="类目名称不能为空"},confirmDeleteCategory(t){0!==t?(this.deleteCategoryIndex=t,this.showDeleteModal=!0):e.index.showToast({title:"默认类目不可删除",icon:"none"})},deleteCategory(){if(null!==this.deleteCategoryIndex){const t=this.categories.splice(this.deleteCategoryIndex,1)[0];delete this.subCategories[t],this.currentMainCategoryIndex=0,this.currentSubCategoryIndex=0,this.filteredClothesByCategory(),e.index.setStorageSync("clothesCategories",this.categories)}this.showDeleteModal=!1,this.deleteCategoryIndex=null,e.index.showToast({title:"删除成功",icon:"success"})},closeDeleteModal(){this.showDeleteModal=!1,this.deleteCategoryIndex=null},onFloatingButtonClick(){e.index.navigateTo({url:"/pages/addClothes/addClothes"})},editClothes(t){e.index.navigateTo({url:`/pages/addClothes/addClothes?data=${encodeURIComponent(JSON.stringify(t))}`})},longpressClothes(e){setTimeout((()=>{this.editModel=!0}),100)},cancleEditMode(){this.editModel=!1},beginEdit(){if(0===this.selectedClothes.length)return void e.index.showToast({title:"请选择衣物",icon:"none"});this.cancleEditMode();const t=this.clothes.filter((e=>this.selectedClothes.includes(e.id)));setTimeout((()=>{e.index.navigateTo({url:`/pages/addMatching/addMatching?data=${encodeURIComponent(JSON.stringify(t))}`})}),100)},deleteClothes(){0!==this.selectedClothes.length?e.index.showModal({title:"确定要删除？",content:"确定彻底删除后将无法恢复！",success:t=>{t.confirm&&(this.clothes=this.clothes.filter((e=>!this.selectedClothes.includes(e.id))),this.filteredClothesByCategory(),this.cancleEditMode(),e.index.setStorageSync("clothes",this.clothes),e.index.showToast({title:"已删除！",icon:"success"}))}}):e.index.showToast({title:"请选择衣物",icon:"none"})},toggleSelect(e){const t=this.selectedClothes.indexOf(e.id);-1===t?this.selectedClothes.push(e.id):this.selectedClothes.splice(t,1)}}};const s=e._export_sfc(o,[["render",function(o,s,i,l,d,r){return e.e({a:e.f(d.categories,((t,o,s)=>({a:e.t(t),b:o,c:d.currentMainCategoryIndex===o?1:"",d:e.o((e=>r.selectMainCategory(o)),o)}))),b:e.f(r.currentSubCategories,((t,o,s)=>({a:e.t(t),b:o,c:d.currentSubCategoryIndex===o?1:"",d:e.o((e=>r.selectSubCategory(o)),o)}))),c:!d.editModel},(d.editModel,{}),{d:0===d.filteredClothesRows.length},0===d.filteredClothesRows.length?{e:t._imports_1$2}:{f:e.f(d.filteredClothesRows,((t,o,s)=>({a:e.f(t,((t,o,s)=>e.e(d.editModel?{a:t.id,b:d.selectedClothes.includes(t.id),c:e.o((e=>r.toggleSelect(t)),o)}:{},{d:t.image,e:e.t(t.name),f:o,g:e.o((e=>d.editModel?r.toggleSelect(t):r.editClothes(t)),o),h:e.o((e=>r.longpressClothes(t)),o)}))),b:e.f(2-((null==t?void 0:t.length)||0),((e,t,o)=>({a:"placeholder"+t}))),c:o}))),g:d.editModel},{h:d.showModal},d.showModal?e.e({i:d.newCategoryName,j:e.o((e=>d.newCategoryName=e.detail.value)),k:d.errorMsg},d.errorMsg?{l:e.t(d.errorMsg)}:{},{m:e.o(((...e)=>r.closeModal&&r.closeModal(...e))),n:e.o(((...e)=>r.addCategory&&r.addCategory(...e)))}):{},{o:!d.editModel},d.editModel?{}:{p:t._imports_1$1,q:e.o(((...e)=>r.onFloatingButtonClick&&r.onFloatingButtonClick(...e)))},{r:d.editModel},d.editModel?{s:t._imports_2,t:e.o(((...e)=>r.cancleEditMode&&r.cancleEditMode(...e))),v:t._imports_3,w:e.o(((...e)=>r.deleteClothes&&r.deleteClothes(...e))),x:t._imports_4,y:e.o(((...e)=>r.beginEdit&&r.beginEdit(...e)))}:{},{z:d.showDeleteModal},d.showDeleteModal?{A:e.o(((...e)=>r.closeDeleteModal&&r.closeDeleteModal(...e))),B:e.o(((...e)=>r.deleteCategory&&r.deleteCategory(...e)))}:{})}],["__scopeId","data-v-ac6f6c73"]]);wx.createPage(s);
